<div class="card h-100 p-0 radius-12">
    <div class="card-body p-24">
        <div class="row justify-content-center">
            <div class="col-xxl-6 col-xl-8 col-lg-10">
                <div class="card border">
                    <div class="card-body">
                        <!-- <h6 class="text-md text-primary-light mb-16">Profile Image</h6> -->

                        <!-- Upload Image Start -->
                        <!-- <div class="mb-24 mt-16">
                            <div class="avatar-upload">
                                <div class="avatar-edit position-absolute bottom-0 end-0 me-24 mt-16 z-1 cursor-pointer">
                                    <input type='file' id="imageUpload" accept=".png, .jpg, .jpeg" hidden>
                                    <label for="imageUpload" class="w-32-px h-32-px d-flex justify-content-center align-items-center bg-primary-50 text-primary-600 border border-primary-600 bg-hover-primary-100 text-lg rounded-circle">
                                        <iconify-icon icon="solar:camera-outline" class="icon"></iconify-icon>
                                    </label>
                                </div>
                                <div class="avatar-preview">
                                    <div id="imagePreview"> </div>
                                </div>
                            </div>
                        </div> -->
                        <!-- Upload Image End -->

                        <form id="addPageForm">
                            <div class="mb-20">
                                <label for="name" class="form-label fw-semibold text-primary-light text-sm mb-8">Page
                                    Name <span class="text-danger-600">*</span></label>
                                <input type="text" class="form-control radius-8" id="name" name="name"
                                    placeholder="Enter Page Name" maxlength="30" pattern="[A-Za-z\s]+"
                                    title="Only letters and spaces allowed, max 30 characters" required>
                                <small class="text-muted">Only letters allowed (max 30 characters)</small>
                            </div>
                            <div class="mb-20">
                                <label for="path"
                                    class="form-label fw-semibold text-primary-light text-sm mb-8">Path</label>
                                <input type="text" class="form-control radius-8" id="path" name="path"
                                    placeholder="e.g., /about or /services" readonly>
                                <small class="text-muted">Path will be auto-generated from page name if left
                                    empty</small>
                            </div>
                            <div class="mb-20">
                                <label for="status"
                                    class="form-label fw-semibold text-primary-light text-sm mb-8">Status</label>
                                <select class="form-control radius-8" id="status" name="status">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                            <!-- <div class="mb-20">
                                <label for="metaTitle" class="form-label fw-semibold text-primary-light text-sm mb-8">Meta Title</label>
                                <input type="text" class="form-control radius-8" id="metaTitle" name="metaTitle" placeholder="Enter Meta Title for SEO">
                            </div>
                            <div class="mb-20">
                                <label for="metaDescription" class="form-label fw-semibold text-primary-light text-sm mb-8">Meta Description</label>
                                <textarea class="form-control radius-8" id="metaDescription" name="metaDescription" rows="3" placeholder="Enter Meta Description for SEO"></textarea>
                            </div> -->
                            <div class="d-flex align-items-center justify-content-center gap-3">
                                <a href="/page-master/web-page-master"
                                    class="border border-danger-600 bg-hover-danger-200 text-danger-600 text-md px-56 py-11 radius-8">
                                    Cancel
                                </a>
                                <button type="submit"
                                    class="btn btn-primary border border-primary-600 text-md px-56 py-12 radius-8">
                                    Save
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<% script=` <script>
    $(document).ready(function() {
    // Validate page name input - only letters and spaces, max 20 characters
    /* $('#name').on('input', function() {
        let value = $(this).val();
        // Remove any numbers and special characters except spaces
        value = value.replace(/[^A-Za-z\s]/g, '');
        // Limit to 20 characters
        if (value.length > 20) {
        value = value.substring(0, 20);
        }
        $(this).val(value);

        // Auto-generate path from page name
        const slug = value.toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');
        const path = slug === 'home' ? '/' : '/' + slug;
        $('#path').val(path);
    }); */
    $('#name').on('input', function() {
        let value = $(this).val();

        // 1. FILTER INPUT: Allow ONLY letters, numbers, and standard spaces.
        // The previous fix ensures we allow standard spaces:
        const cleanedValue = value.replace(/[^A-Za-z0-9\s ]/g, '');

        // Update the input field only if cleaning occurred
        if (value !== cleanedValue) {
            $(this).val(cleanedValue);
            value = cleanedValue; 
        }
        
        // 2. ENFORCE MAX LENGTH (30 characters)
        if (value.length > 30) {
            value = value.substring(0, 30);
            if ($(this).val().length > 30) {
                $(this).val(value);
            }
        }

        // 3. AUTO-GENERATE ROBUST SLUG/PATH
        const slug = value.toLowerCase()
        // 1. Replace ALL non-alphanumeric characters (including spaces and symbols) 
        //    with a single hyphen. This is the most reliable way to create a slug.
        .replace(/[^a-z0-9]+/g, '-') 
        // 2. Remove any leading or trailing hyphens
        .replace(/^-+|-+$/g, ''); 

        // Determine the final path
        // If the slug is empty, set path to '', otherwise prepend '/'
        const path = slug === '' ? '' : (slug === 'home' ? '/' : '/' + slug);

        $('#path').val(path);
    });

    // Handle form submission
    $('#addPageForm').on('submit', function(e) {
        e.preventDefault();

        const formData = {
            name: $('#name').val(),
            path: $('#path').val() || undefined,
            status: $('#status').val(),
            metaTitle: $('#metaTitle').val(),
            metaDescription: $('#metaDescription').val()
        };

        $.ajax({
            url: '/api/pages',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function(response) {
                if (response.success) {
                    showToast('Page created successfully!', 'success');
                    setTimeout(function() {
                        window.location.href = '/page-master/web-page-master';
                    }, 1000);
                } else {
                    showToast('Error: ' + response.message, 'error');
                }
            },
            error: function(xhr) {
                console.error('Full error:', xhr);
                let errorMessage = 'Unknown error';

                if (xhr.responseJSON) {
                    errorMessage = xhr.responseJSON.message || xhr.responseJSON.error || 'Unknown error';
                } else if (xhr.responseText) {
                    try {
                        const errorData = JSON.parse(xhr.responseText);
                        errorMessage = errorData.message || errorData.error || 'Unknown error';
                    } catch (e) {
                        errorMessage = xhr.responseText;
                    }
                }

                showToast('Error creating page: ' + errorMessage, 'error');
            }
        });
    });
    });
    </script>
    ` %>