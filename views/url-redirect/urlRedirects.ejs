<div class="card h-100 p-0 radius-12">
    <div
        class="card-header border-bottom bg-base py-16 px-24 d-flex align-items-center flex-wrap gap-3 justify-content-between">
        <div class="d-flex align-items-center flex-wrap gap-3">
            <form class="navbar-search">
                <input type="text" id="searchInput" class="bg-base h-40-px w-auto" name="search"
                    placeholder="Search ">
                <iconify-icon icon="ion:search-outline" class="icon"></iconify-icon>
            </form>
        </div>
        <a href="/url-redirect/add-redirect" class="btn btn-primary btn-sm d-flex align-items-center gap-1">
            <iconify-icon icon="ic:baseline-plus" class="icon text-xl line-height-1"></iconify-icon> Add New Redirect
        </a>
    </div>
    <div class="card-body p-24">
        <div class="mb-3" id="bulkDeleteContainer" style="display: none;">
            <button class="btn btn-danger-600 radius-8 px-20 py-11" id="bulkDeleteBtn">
                <i class="ri-delete-bin-line me-1"></i> Delete Selected
            </button>
        </div>

        <div class="table-responsive scroll-sm">
            <table class="table bordered-table sm-table mb-0" id="redirectsTable">
                <thead>
                    <tr>
                        <th>
                            <div class="form-check style-check d-flex align-items-center">
                                <input class="form-check-input" type="checkbox" id="selectAll">
                            </div>
                        </th>
                        <th>Old URL</th>
                        <th>New URL</th>
                        <th>Type</th>
                        <th>Status</th>
                        <!-- <th>Hits</th>
                        <th>Last Accessed</th> -->
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (redirects && redirects.length> 0) { %>
                        <% redirects.forEach(redirect=> { %>
                            <tr>
                                <td>
                                    <div class="form-check style-check d-flex align-items-center">
                                        <input class="form-check-input redirect-checkbox" type="checkbox"
                                            value="<%= redirect._id %>">
                                    </div>
                                </td>
                                <td>
                                    <span class="text-primary-600"><code><%= redirect.oldUrl %></code></span>
                                </td>
                                <td>
                                    <code><%= redirect.newUrl %></code>
                                </td>
                                <td>
                                    <span
                                        class="badge custom-badge badge-secondary">301</span>
                                </td>
                                <td>
                                    <% if (redirect.isActive) { %>
                                        <span
                                            class="badge custom-badge badge-outline-success">Active</span>
                                        <% } else { %>
                                            <span
                                                class="badge custom-badge badge-outline-secondary">Inactive</span>
                                            <% } %>
                                </td>
                                <!-- <td><%= redirect.hitCount || 0 %></td>
                                <td>
                                    <% if (redirect.lastAccessed) { %>
                                        <%= new Date(redirect.lastAccessed).toLocaleDateString() %>
                                    <% } else { %>
                                        <span class="text-secondary-light">Never</span>
                                    <% } %>
                                </td> -->
                                <td class="text-center">
                                    <div class="d-flex align-items-center gap-10 justify-content-center">
                                        <a href="/url-redirect/edit-redirect/<%= redirect._id %>"
                                            class="btn btn-sm btn-outline-secondary">
                                            <!-- <iconify-icon icon="lucide:edit" class="icon text-xl"></iconify-icon> -->
                                             <iconify-icon icon="material-symbols:edit-outline"></iconify-icon>
                                        </a>
                                        <button type="button"
                                            class="remove-item-btn btn btn-sm btn-outline-danger"
                                            onclick="deleteRedirect('<%= redirect._id %>')">
                                            <!-- <iconify-icon icon="fluent:delete-24-regular" class="menu-icon"></iconify-icon> -->
                                             <iconify-icon icon="material-symbols:delete-outline"></iconify-icon>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <% }); %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="8" class="text-center py-4">
                                            <span class="text-secondary-light">No redirects found</span>
                                        </td>
                                    </tr>
                                    <% } %>
                </tbody>
            </table>
        </div>

        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mt-24">
            <span id="entriesInfo">
                <% if (redirects && redirects.length> 0) { %>
                    Showing <span id="visibleCount">
                        <%= redirects.length %>
                    </span> of <span id="totalCount">
                        <%= redirects.length %>
                    </span> entries
                    <% } else { %>
                        No entries found
                        <% } %>
            </span>
        </div>
    </div>
</div>

<% script=` <script>
    // Select all checkboxes
    document.getElementById('selectAll').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.redirect-checkbox');
    checkboxes.forEach(cb => cb.checked = this.checked);
    toggleBulkDelete();
    });

    // Individual checkbox change
    document.querySelectorAll('.redirect-checkbox').forEach(cb => {
    cb.addEventListener('change', toggleBulkDelete);
    });

    function toggleBulkDelete() {
    const checked = document.querySelectorAll('.redirect-checkbox:checked');
    const bulkDeleteContainer = document.getElementById('bulkDeleteContainer');
    bulkDeleteContainer.style.display = checked.length > 0 ? 'block' : 'none';
    }

    // Bulk delete
    document.getElementById('bulkDeleteBtn').addEventListener('click', async function() {
    const checked = document.querySelectorAll('.redirect-checkbox:checked');
    const ids = Array.from(checked).map(cb => cb.value);

    if (ids.length === 0) return;

    Swal.fire({
    title: 'Delete Redirects?',
    text: 'Are you sure you want to delete ' + ids.length + ' redirect(s)? This action cannot be undone.',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#dc3545',
    cancelButtonColor: '#6c757d',
    confirmButtonText: 'Yes, delete them!',
    cancelButtonText: 'Cancel',
    reverseButtons: true
    }).then(async (result) => {
    if (result.isConfirmed) {
    try {
    const response = await fetch('/api/url-redirects/bulk-delete', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ ids })
    });

    const result = await response.json();

    if (result.success) {
    Swal.fire({
    title: 'Deleted!',
    text: result.message,
    icon: 'success',
    timer: 2000,
    showConfirmButton: false
    });
    setTimeout(() => location.reload(), 2000);
    } else {
    Swal.fire('Error!', result.message, 'error');
    }
    } catch (error) {
    console.error('Error:', error);
    Swal.fire('Error!', 'An error occurred while deleting redirects', 'error');
    }
    }
    });
    });

    // Delete single redirect
    async function deleteRedirect(id) {
    Swal.fire({
    title: 'Delete Redirect?',
    text: 'Are you sure you want to delete this redirect? This action cannot be undone.',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#dc3545',
    cancelButtonColor: '#6c757d',
    confirmButtonText: 'Yes, delete it!',
    cancelButtonText: 'Cancel',
    reverseButtons: true
    }).then(async (result) => {
    if (result.isConfirmed) {
    try {
    const response = await fetch('/api/url-redirects/' + id, {
    method: 'DELETE'
    });

    const result = await response.json();

    if (result.success) {
    Swal.fire({
    title: 'Deleted!',
    text: result.message,
    icon: 'success',
    timer: 2000,
    showConfirmButton: false
    });
    setTimeout(() => location.reload(), 2000);
    } else {
    Swal.fire('Error!', result.message, 'error');
    }
    } catch (error) {
    console.error('Error:', error);
    Swal.fire('Error!', 'An error occurred while deleting the redirect', 'error');
    }
    }
    });
    }

    // Search functionality
    $('#searchInput').on('keyup', function() {
    applyFilters();
    });

    // Filter and search functionality
    function applyFilters() {
    const searchTerm = $('#searchInput').val().toLowerCase().trim();
    let visibleCount = 0;

    $('tbody tr').each(function() {
    // Skip the "no results" row
    if ($(this).hasClass('no-results-row')) {
    return;
    }

    // Skip the "no redirects found" default row
    if ($(this).find('td').length === 1 && $(this).find('td').attr('colspan')) {
    return;
    }

    const oldUrl = $(this).find('td:nth-child(2)').text().toLowerCase();
    const newUrl = $(this).find('td:nth-child(3)').text().toLowerCase();

    // Check if row matches search term
    const matchesSearch = searchTerm === '' || oldUrl.includes(searchTerm) || newUrl.includes(searchTerm);

    if (matchesSearch) {
    $(this).show();
    visibleCount++;
    } else {
    $(this).hide();
    }
    });

    // Update visible count
    $('#visibleCount').text(visibleCount);

    // Show/hide "no results" message
    if (visibleCount === 0) {
    if ($('.no-results-row').length === 0) {
    let message = searchTerm !== '' ? 'No redirects found matching "' + searchTerm + '"' : 'No redirects found';

    $('tbody').append(
    '<tr class="no-results-row">' +
        '<td colspan="8" class="text-center py-4">' +
            '<div class="text-muted">' +
                '<iconify-icon icon="mdi:magnify-close" class="text-4xl mb-2"></iconify-icon>' +
                '<p>' + message + '</p>' +
                '</div>' +
            '</td>' +
        '</tr>'
    );
    }
    } else {
    $('.no-results-row').remove();
    }
    }
    </script>
    ` %>