╔══════════════════════════════════════════════════════════════════════════════╗
║                    SITE SETTINGS API - SECURITY ARCHITECTURE                 ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                              PUBLIC USER                                     │
│                         (No Authentication)                                  │
└────────────────────────────────┬────────────────────────────────────────────┘
                                 │
                                 │ GET /settings/api/social-links
                                 │ GET /settings/api/site-settings
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           PUBLIC API ROUTES                                  │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │  Query: SiteSettings.findOne()                                     │    │
│  │         .select('logo siteName socialMedia contactEmail')          │    │
│  │                                                                     │    │
│  │  ✅ Explicitly selects ONLY public fields                          │    │
│  │  ❌ SMTP fields are NOT selected                                   │    │
│  └────────────────────────────────────────────────────────────────────┘    │
└────────────────────────────────┬────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            MONGODB DATABASE                                  │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │  SiteSettings Collection                                           │    │
│  │                                                                     │    │
│  │  {                                                                 │    │
│  │    logo: "/uploads/logo.png",              ← ✅ PUBLIC             │    │
│  │    siteName: "My Site",                    ← ✅ PUBLIC             │    │
│  │    socialMedia: { ... },                   ← ✅ PUBLIC             │    │
│  │    contactEmail: "contact@example.com",    ← ✅ PUBLIC             │    │
│  │                                                                     │    │
│  │    smtp: {                                 ← ❌ PROTECTED          │    │
│  │      username: "admin@example.com",        ← ❌ select: false      │    │
│  │      password: "secret123"                 ← ❌ select: false      │    │
│  │    }                                                                │    │
│  │  }                                                                 │    │
│  └────────────────────────────────────────────────────────────────────┘    │
└────────────────────────────────┬────────────────────────────────────────────┘
                                 │
                                 │ Returns ONLY selected fields
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           API RESPONSE                                       │
│                                                                              │
│  {                                                                           │
│    "success": true,                                                          │
│    "data": {                                                                 │
│      "logo": "/uploads/logo.png",              ✅ Safe to expose            │
│      "siteName": "My Site",                    ✅ Safe to expose            │
│      "socialMedia": {                          ✅ Safe to expose            │
│        "facebook": "https://facebook.com/...",                              │
│        "telegram": "https://t.me/...",                                      │
│        "instagram": "https://instagram.com/..."                             │
│      },                                                                      │
│      "contactEmail": "contact@example.com"     ✅ Safe to expose            │
│    }                                                                         │
│    // NO smtp field - completely hidden! 🔒                                 │
│  }                                                                           │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════


┌─────────────────────────────────────────────────────────────────────────────┐
│                          AUTHENTICATED ADMIN                                 │
│                      (Logged in with permissions)                            │
└────────────────────────────────┬────────────────────────────────────────────┘
                                 │
                                 │ GET /settings/site-settings (page)
                                 │ POST /settings/site-settings (update)
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      AUTHENTICATION MIDDLEWARE                               │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │  isAuthenticated()                                                 │    │
│  │                                                                     │    │
│  │  ✅ Check if user is logged in                                     │    │
│  │  ✅ Check if user has 'settings' permission                        │    │
│  │  ✅ Check if user is 'super-admin'                                 │    │
│  │                                                                     │    │
│  │  ❌ If not authenticated → Redirect to login                       │    │
│  │  ❌ If no permission → Access denied                               │    │
│  └────────────────────────────────────────────────────────────────────┘    │
└────────────────────────────────┬────────────────────────────────────────────┘
                                 │
                                 │ ✅ Authentication passed
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          ADMIN API ROUTES                                    │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │  Query: SiteSettings.findOne()                                     │    │
│  │         .select('+smtp.host +smtp.username +smtp.password')        │    │
│  │                                                                     │    │
│  │  ✅ Explicitly includes SMTP fields (using + prefix)               │    │
│  │  ✅ Admin can see and edit SMTP settings                           │    │
│  └────────────────────────────────────────────────────────────────────┘    │
└────────────────────────────────┬────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            MONGODB DATABASE                                  │
│                         (Returns ALL fields)                                 │
│                                                                              │
│  {                                                                           │
│    logo: "/uploads/logo.png",                                               │
│    siteName: "My Site",                                                     │
│    socialMedia: { ... },                                                    │
│    smtp: {                                                                  │
│      host: "smtp.gmail.com",                                                │
│      username: "admin@example.com",      ← ✅ Admin can see this           │
│      password: "secret123"               ← ✅ Admin can see this           │
│    }                                                                         │
│  }                                                                           │
└────────────────────────────────┬────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        ADMIN SETTINGS PAGE                                   │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │  Site Logo: [Upload]                                               │    │
│  │  Site Name: [My Site                    ]                          │    │
│  │  Social Media: [Facebook, Telegram, etc.]                          │    │
│  │                                                                     │    │
│  │  ═══════════════════════════════════════                           │    │
│  │  SMTP Configuration (Admin Only)                                   │    │
│  │  ═══════════════════════════════════════                           │    │
│  │  SMTP Host:     [smtp.gmail.com        ]  ← ✅ Visible to admin   │    │
│  │  SMTP Username: [admin@example.com     ]  ← ✅ Visible to admin   │    │
│  │  SMTP Password: [••••••••••••••        ]  ← ✅ Visible to admin   │    │
│  │                                                                     │    │
│  │  [Test SMTP]  [Save Settings]                                      │    │
│  └────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════

                            SECURITY SUMMARY

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  PUBLIC USERS                           AUTHENTICATED ADMINS                │
│  ═══════════════                        ════════════════════                │
│                                                                              │
│  Can Access:                            Can Access:                         │
│  ✅ Logo                                ✅ Everything public users can      │
│  ✅ Site Name                           ✅ SMTP Configuration                │
│  ✅ Social Media Links                  ✅ Upload Logo                       │
│  ✅ Contact Info                        ✅ Update Settings                   │
│                                         ✅ Test SMTP                         │
│  Cannot Access:                                                             │
│  ❌ SMTP Credentials                    Protected By:                       │
│  ❌ Admin Details                       🔒 isAuthenticated middleware       │
│  ❌ Sensitive Config                    🔒 Permission checks                │
│                                         🔒 Schema-level protection          │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════

                        SECURITY LAYERS

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  Layer 1: SCHEMA LEVEL                                                      │
│  ══════════════════════                                                     │
│  smtp: {                                                                    │
│    username: { type: String, select: false }  ← Hidden by default          │
│  }                                                                          │
│                                                                              │
│  Layer 2: QUERY LEVEL                                                       │
│  ═════════════════════                                                      │
│  Public:  .select('logo siteName')            ← Only public fields         │
│  Admin:   .select('+smtp.username')           ← Explicit inclusion         │
│                                                                              │
│  Layer 3: ROUTE LEVEL                                                       │
│  ═════════════════════                                                      │
│  Public:  No authentication required          ← Open access                │
│  Admin:   isAuthenticated middleware          ← Protected access           │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════

                    🔒 YOUR SMTP CREDENTIALS ARE SAFE! 🔒

                  ✅ Never exposed in public APIs
                  ✅ Protected at schema level
                  ✅ Only accessible to authenticated admins
                  ✅ Multiple security layers
                  ✅ Production-ready

═══════════════════════════════════════════════════════════════════════════════
